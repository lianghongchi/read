{[include file="../common/header.html"]}

<link href="{[$_resource.admin_static]}/css/fonts/awesome/css/font-awesome.css" rel="stylesheet">

<style type="text/css">
    body {
        background-color: #F2F2F2;
        color: #666;
    }

    .layui-fluid {
        padding: 0px 15px;
    }

    /* 重置轮播样式 */
    .layadmin-carousel {
        height: 185px !important;
        background-color: #fff;
    }

    .layadmin-carousel .layui-carousel-ind li {
        background-color: #e2e2e2;
    }

    .layadmin-carousel .layui-carousel-ind li:hover {
        background-color: #c2c2c2;
    }

    .layadmin-carousel .layui-carousel-ind li.layui-this {
        background-color: #999;
    }

    .layadmin-carousel .layui-carousel,
    .layadmin-carousel>*[carousel-item]>* {
        background-color: #fff;
    }

    .layadmin-carousel .layui-col-space10 {
        margin: 0;
    }

    .layadmin-carousel .layui-carousel-ind {
        position: absolute;
        top: -41px;
        text-align: right;
    }

    .layadmin-carousel .layui-carousel-ind ul {
        background: none;
    }

    /* 快捷方式 */

    .layadmin-shortcut li {
        text-align: center;
    }

    .layadmin-shortcut li .layui-icon {
        display: inline-block;
        width: 100%;
        height: 60px;
        line-height: 60px;
        text-align: center;
        color: #333;
        border-radius: 2px;
        font-size: 30px;
        transition: all .3s;
        background-color: #F8F8F8;
        -webkit-transition: all .3s;
    }

    .layadmin-shortcut li cite {
        position: relative;
        top: 2px;
        display: block;
        color: #666;
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
        font-size: 14px;
    }

    .layadmin-shortcut li:hover .layui-icon {
        opacity: 0.9;
    }

    /* 待办事项 */

    .layadmin-backlog .layadmin-backlog-body {
        display: block;
        padding: 10px 15px;
        background-color: #f8f8f8;
        color: #999;
        border-radius: 2px;
        transition: all .3s;
        -webkit-transition: all .3s;
    }

    .layadmin-backlog-body h3 {
        padding-bottom: 10px;
        font-size: 12px;
    }

    .layadmin-backlog-body p cite {
        font-style: normal;
        font-size: 30px;
        font-weight: 300;
        color: #009688;
    }

    .layadmin-backlog-body:hover {
        background-color: #f2f2f2;
        color: #888;
    }

    /* 数据概览 */

    .layadmin-dataview {
        height: 332px !important;
    }

    .layadmin-dataview>*[carousel-item]:before {
        display: none;
    }

    .layadmin-dataview>*[carousel-item]>div {
        height: 332px;
    }

    /* 控制台效果报告 */

    .layadmin-takerates {
        padding-top: 5px;
    }

    .layadmin-takerates .layui-progress {
        margin: 50px 0 60px;
    }

    .layadmin-takerates .layui-progress:last-child {
        margin-bottom: 10px;
    }

    .layadmin-takerates .layui-progress h3 {
        position: absolute;
        right: 0;
        top: -35px;
        color: #999;
        font-size: 14px;
    }

    .layadmin-takerates .layui-progress-bar {
        text-align: left;
    }

    .layadmin-takerates .layui-progress-text {
        top: -35px;
        line-height: 26px;
        font-size: 26px;
    }

    .home_icon {
        display: inline-block;
        width: 100%;
        height: 60px;
        line-height: 60px;
        text-align: center;
        color: #fff;
        border-radius: 2px;
        font-size: 30px;
        transition: all .3s;
        -webkit-transition: all .3s;
        background-color: #6FBF85;
    }

    .home_icon:hover {
        opacity: 0.8;
    }
</style>

<div class="layui-row layui-col-space15">
    <div class="layui-col-md8">
        <div class="layui-row layui-col-space15">
            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">基本操作</div>
                    <div class="layui-card-body">
                        <div class="layui-carousel layadmin-carousel layadmin-shortcut" lay-anim="" lay-indicator="inside" lay-arrow="none">
                            <div carousel-item="">
                                <ul class="layui-row layui-col-space10 layui-this">

                                    <li class="layui-col-xs3">
                                        <a class="_open_window" w-url="{[$_baseUrl]}/admin/password/edit" w-area="['750px', '450px']" w-info="修改登录密码">
                                            <i class="home_icon fa fa-lock"></i>
                                            <cite>修改密码</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a id="admin_logout">
                                            <i class="home_icon fa fa-sign-out" style="background-color: orange;"></i>
                                            <cite>退出账号</cite>
                                        </a>
                                    </li>

                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="layui-col-md6">
                <div class="layui-card">
                    <div class="layui-card-header">快捷方式</div>
                    <div class="layui-card-body">
                        <div class="layui-carousel layadmin-carousel layadmin-shortcut" lay-anim="" lay-indicator="inside" lay-arrow="none" style="width: 100%; height: 280px;">
                            <div carousel-item="">
                                <ul class="layui-row layui-col-space10 layui-this">
                                    <li class="layui-col-xs3">
                                        <a lay-href="home/homepage1">
                                            <i class="layui-icon layui-icon-console"></i>
                                            <cite>主页一</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="home/homepage2">
                                            <i class="layui-icon layui-icon-chart"></i>
                                            <cite>主页二</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="component/layer/list">
                                            <i class="layui-icon layui-icon-template-1"></i>
                                            <cite>弹层</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="/senior/im/">
                                            <i class="layui-icon layui-icon-chat"></i>
                                            <cite>聊天</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="component/progress/index">
                                            <i class="layui-icon layui-icon-find-fill"></i>
                                            <cite>进度条</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="app/workorder/list">
                                            <i class="layui-icon layui-icon-survey"></i>
                                            <cite>工单</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="user/user/list">
                                            <i class="layui-icon layui-icon-user"></i>
                                            <cite>用户</cite>
                                        </a>
                                    </li>
                                    <li class="layui-col-xs3">
                                        <a lay-href="set/system/website">
                                            <i class="layui-icon layui-icon-set"></i>
                                            <cite>设置</cite>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="layui-carousel-ind">
                                <button type="button" class="layui-btn layui-btn-xs" name="">编辑</button>
                            </div>

                            <button class="layui-icon layui-carousel-arrow" lay-type="sub"></button><button class="layui-icon layui-carousel-arrow" lay-type="add"></button>
                        </div>

                    </div>
                </div>
            </div>

            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">最近10次登录历史</div>
                    <div class="layui-card-body">
                        <table class="layui-static-table" lay-filter="table_data" lay-size="">
                            <thead>
                            <tr>
                                <th lay-data="{field:'add_time_text', sort:true}">登录时间</th>
                                <th lay-data="{field:'ip'}">登录IP</th>
                                <th lay-data="{field:'avatar'}">状态</th>
                                <th lay-data="{field:'browser'}">浏览器</th>
                            </tr>
                            </thead>
                            <tbody>
                                {[foreach $loginList as $key => $val]}
                                <tr>
                                    <td>{[$val.add_time_text]}</td>
                                    <td>{[$val.ip]}</td>
                                    <td>{[$val.status_text]}</td>
                                    <td>{[$val.agent]}</td>
                                </tr>
                                {[/foreach]}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="layui-col-md4">
        <div class="layui-card">
            <div class="layui-card-header">管理员信息</div>
            <div class="layui-card-body layui-text">
                <table class="layui-table">
                    <colgroup>
                        <col width="100">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr>
                            <td align="right">管理员ID</td>
                            <td>
                                {[$_admin.admin_id]}
                            </td>
                        </tr>
                        <tr>
                            <td align="right">用户名称</td>
                            <td>
                                {[$_admin.admin_name]}
                            </td>
                        </tr>
                        <tr>
                            <td align="right">姓名</td>
                            <td>
                                {[$_admin.name]}
                            </td>
                        </tr>
                        <tr>
                            <td align="right">手机号码</td>
                            <td>
                                {[substr_replace($_admin.cellphone, '****', 3, 4)]}
                            </td>
                        </tr>
                        <tr>
                            <td align="right">权限组</td>
                            <td>
                                {[if $_admin.is_super]}
                                <span class="layui-badge layui-bg-blue">超级管理员</span>
                                {[else]}
                                {[foreach $roles as $k => $v]}
                                <span class="layui-badge-rim">{[$v.name]}</span><br>
                                {[/foreach]}
                                {[/if]}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="layui-card">
            <div class="layui-card-header">系统信息</div>
            <div class="layui-card-body layui-text">
                <table class="layui-table">
                    <colgroup>
                        <col width="95">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr>
                            <td>框架版本</td>
                            <td>
                                v{[$coreVersion]}
                            </td>
                            <td>PHP版本</td>
                            <td>v{[$phpVersion]}</td>
                        </tr>
                        <tr>
                            <td>服务器ID</td>
                            <td colspan="3">v{[$hostname]}</td>
                        </tr>
                        <tr>
                            <td>操作系统</td>
                            <td colspan="3">{[if $os]}{[$os]}{[else]}不支持的操作系统{[/if]}</td>
                        </tr>
                        <tr>
                            <td>处&nbsp;&nbsp;理&nbsp;&nbsp;器<br>[{[$cpu.num]}核心]</td>
                            <td colspan="3">{[$cpu.info[0]['name']]}<br>频率：{[$cpu.info[0]['mhz']]}，二级缓存：{[$cpu.info[0]['cache']]}</td>
                        </tr>
                        <tr>
                            <td>运行时间</td>
                            <td id="sys_runtime" colspan="3">未获取</td>
                        </tr>
                    </tbody>
                </table>
                <div class="layui-card-body layadmin-takerates" style="padding: 0px;">
                    <!--<h6>[间隔1分钟统计一次]</h6>-->
                    <div class="layui-progress" lay-filter="st_cpu" lay-showpercent="yes">
                        <h3>CPU使用率</h3>
                        <div id="st_cpu" class="layui-progress-bar" lay-percent="0%"><span class="layui-progress-text">0%</span></div>
                    </div>
                    <div class="layui-progress" lay-showpercent="yes" lay-filter="st_mem">
                        <h3>内存占用率<span id="st_mem_total"></span></h3>
                        <div id="st_mem" class="layui-progress-bar" lay-percent="0%"><span class="layui-progress-text">0%</span></div>
                    </div>
                    <div class="layui-progress" lay-showpercent="yes">
                        <h3>硬盘占用率，剩余{[$disk.diskFree]}G</h3>
                        <div lay-percent="{[$disk.diskPercent]}%" {[if ($disk.diskPercent> 75)]}
                            class="layui-progress-bar layui-bg-red"
                            {[elseif ($disk.diskPercent > 50)]}
                            class="layui-progress-bar layui-bg-orange"
                            {[else]}
                            class="layui-progress-bar"
                            {[/if]}
                            >
                            <span class="layui-progress-text">0</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{[include file="../common/footer.html"]}

<script type="text/javascript" src="{[$_resource.admin_static]}/js/echarts/echarts.js"></script>
<script type="text/javascript" src="{[$_resource.admin_static]}/js/echarts/theme/macarons.js"></script>

<script type="text/javascript">
    var getSysInfoUrl = "{[$_baseUrl]}/index/get_sysinfo";
    var stat = {[if $stat]}{[$stat]}{[else]}""{[/if]};

    var layer = layui.layer;
    var element = layui.element;
    var table = layui.table;

    table.init('table_data', {
        height: '430',
        limit: 500,
    });

    // 退出账号
    $('#admin_logout').click(function() {
        layer.confirm('确认退出账号吗？', {
            icon: 3,
            title: '提示',
            area: '300px',
            shadeClose: true
        }, function(index) {
            location.href = "{[$_baseUrl]}/login/logout";
        });
    });

    setTimeout(sysProgress, 500);
    setInterval(sysProgress, 60000000);

    // 获取系统信息
    function sysProgress() {
        $.getJSON(getSysInfoUrl, '', function(redata) {
            console.log(redata);

            if (redata.code != 200) {
                return;
            }

            var data = redata.data;

            statTotal = 0
            for (var i = 0; i < data.stat.length; i++) {
                stat[i] = data.stat[i] - stat[i];
                statTotal += stat[i];
            }

            var cpuOj = $('#st_cpu');
            var memOj = $('#st_mem');

            var cpuPercent = 100 * (1 - (stat[3] + stat[4]) / statTotal);
            cpuPercent = cpuPercent.toFixed(2);
            stat = data.stat;

            var memPercent = data.meminfo.memPercent;

            // cpu
            if (cpuPercent > 75) {
                cpuOj.removeClass().addClass('layui-progress-bar layui-bg-red');
            } else if (cpuPercent > 50) {
                cpuOj.removeClass().addClass('layui-progress-bar layui-bg-orange');
            } else {
                cpuOj.removeClass().addClass('layui-progress-bar');
            }
            // 内存
            if (memPercent > 75) {
                memOj.removeClass().addClass('layui-progress-bar layui-bg-red');
            } else if (memPercent > 50) {
                memOj.removeClass().addClass('layui-progress-bar layui-bg-orange');
            } else {
                memOj.removeClass().addClass('layui-progress-bar');
            }
            // 运行时间
            $('#sys_runtime').html(data.uptime);
            $('#st_mem_total').html('，剩余' + data.meminfo.memFree);
            element.progress('st_cpu', cpuPercent + '%');
            element.progress('st_mem', memPercent + '%');
        });
    }

</script>
